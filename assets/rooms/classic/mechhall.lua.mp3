-- MECHHALL MODERNIZED

function sectionPowerUp()
	b = mgRndInt(0, 3)
	if b == 0 then
		mgBox(0.5, 0.25, 0.5, 0, 0.25, z-2)
		mgPowerUp("multiball", 0, 0.75, z-2)
	end
	if b == 1 or b == 2 then
		mgBox(0.5, 0.25, 0.5, 0, 0.25, z-2)
		mgPowerUp("balls", 0, 0.75, z-2)
	end
	if mgRndBool() then
		mgObstacle("classic/scoretop", -2, 0, z-2)
		mgObstacle("classic/scoretop", 2, 0, z-2)
	else
		buildPillar(-2, 0, z)
		buildPillar(2, 0, z)
	end
	
	z = z - 5
end


function sectionCrank()
	mgObstacle("classic/bigcrank", 0, 0, z)
	z = z - 8
end

function sectionBeatMill()
	mgObstacle("classic/beatmill", 0, 0, z)
	z = z - 8
end

function sectionCube()
	mgObstacle("classic/suspendcube", 0, 0, z)
	z = z - 8
end


function sectionBox()
	mgObstacle("classic/suspendbox", 0, 0, z-2)
	z = z - 5
end


function sectionWindow()
	buildPillar(-3, 0, z)
	buildPillar(3, 0, z)
	mgObstacle("classic/suspendwindow", 0, 0, z)
	z = z - 5
end

function sectionTippingBoard()
	buildPillar(-3, 0, z-2)
	buildPillar(3, 0, z-2)
	buildPillar(-3, 0, z+2)
	buildPillar(3, 0, z+2)
	mgObstacle("classic/tippingboard", 0, 0, z)
	z = z - 5
end


function init()
	mgRandomize(mgGetInt("seed", math.random(0, 100)))
	difficulty = mgGetFloat("difficulty", 0.0)
	
	length = 60 + 20 * difficulty
	
	--Setup
	mgLength(length)
	mgSpeedMultiplier(1.0)
	
	mgMusic("2") 

	--Four walls
	mgColor(1,1,1)
	buildWalls(7, 4, length)

	addSection(sectionPowerUp, 2)
	addSection(sectionBeatMill, 1)
	addSection(sectionBox, 1)
	addSection(sectionWindow, 1)
	addSection(sectionTippingBoard, 1, 1)
	if difficulty >= 0.5 then
		addSection(sectionCrank, 1)
		addSection(sectionCube, 1)
	end

	z = -7
	while z > -length+5 do
		func = nextSection()
		func()
		z = z - 5 * (1-difficulty)
	end
	
	--Door at end
	buildEndWall(7, 5, length, 2, 2, 0.5)
	mgObstacle("classic/door1", 0, 0, -length, "buttons="..mgRndInt(0,2))	
end


