-- BEATROOM MODERNIZED

function sectionBeatMill()
	mgBox(7.5, 0.2, 0.3, 0, 3.5, z)
	mgObstacle("classic/scoretop", 1, 4, z);
	mgObstacle("classic/scoretop", -1, 4, z);
	mgObstacle("classic/beatmill", 0, 0, z)
	z = z - 8
end


function sectionBeatSweeper()
	buildPillar(-3, 0, z)
	buildPillar(3, 0, z)
	buildPillar(-3, 0, z+2)
	buildPillar(3, 0, z+2)
	buildPillar(-3, 0, z-2)
	buildPillar(3, 0, z-2)
	mgBox(7.5, 0.42, 0.1, 0, 2.5, z-1)
	mgBox(7.5, 0.42, 0.1, 0, 2.5, z+1)
	mgPowerUp("balls", 0, 3, z+1)
	if difficulty > 0.3 and mgRndBool() then
		mgObstacle("classic/beatsweeper", 0, 0, z+1)
		mgObstacle("classic/beatsweeper", 0, 0, z-1, "offset=4")
	else
		mgObstacle("classic/beatsweeper", 0, 0, z+1, "wide=false")
		mgObstacle("classic/beatsweeper", 0, 0, z-1, "wide=false", "offset=2")
	end
	z = z - 5
end


function sectionBeatWindow()
	buildPillar(-3, 0, z)
	buildPillar(3, 0, z)
	buildPillar(-5, 0, z)
	buildPillar(5, 0, z)
	mgBox(0.5, 0.15, 0.5, -2, 0.15, z+5)
	mgBox(0.5, 0.15, 0.5, 2, 0.15, z+5)
	local r = mgRndInt(0, 5)
	if r == 0 then
		mgPowerUp("ballfrenzy", -2, 0.7, z+5)
		mgPowerUp("slowmotion", 2, 0.7, z+5)
	else
		mgPowerUp("balls", -2, 0.7, z+5)
		mgPowerUp("balls", 2, 0.7, z+5)
	end
	mgObstacle("classic/beatwindow", -1, 0.1, z, "w=1", "beat=1")
	mgObstacle("classic/beatwindow", 0, 0.1, z, "w=1", "beat=2")
	mgObstacle("classic/beatwindow", 1, 0.1, z, "w=1", "beat=3")
	mgBox(2, 0.25, 0.1, 0, 0.25, z+1)
	z = z - 5
end


function init()
	mgRandomize(mgGetInt("seed", math.random(0, 100)))
	difficulty = mgGetFloat("difficulty", 0.0)
	
	length = 60 + 20 * difficulty
	
	--Setup
	mgLength(length)
	mgSpeedMultiplier(1.0)
	
	mgMusic("2") 

	--Four walls
	mgColor(1,1,1)
	buildWalls(15, 8, length)

	addSection(sectionBeatMill, 1)
	addSection(sectionBeatSweeper, 1)
	if difficulty >= 0.5 then
		addSection(sectionBeatWindow, 1)
	end

	z = -10
	while z > -length+10 do
		z = z - 8 * (1-difficulty)
		func = nextSection()
		func()
	end
	
	--Door at end
	buildEndWall(15, 8, length, 2, 2, 0.5)
	mgObstacle("classic/door1", 0, 0, -length, "buttons="..mgRndInt(0,2))	
end


